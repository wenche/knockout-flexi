#!/usr/bin/env node

var docpath = '/home/nanhadev/node-black-edition/nodejs/doc/api';
var rest = require('restler'),
    fs = require('fs'),
    byline = require('byline'),
    args = require('optimist').argv;

fs.unlinkSync('input.txt');
var fs = require('fileutils');
fs.copy(args.url, 'input.txt', function (err) {
  if (err) {
    throw err;
  }

    var read = byline(fs.createReadStream('input.txt'));
    var write = fs.createWriteStream('output.txt');
    var arr = [];
    read.on('data', function (data) {
        //console.log('--->', data);
        _data = "\\t" + data.replace(/"/g, '\\"');
        if (/###/.test(_data)) {
            arr.push(',"' + _data + '".magenta');
        } else if (/##/.test(_data)) {
            arr.push(',"' + _data + '".cyan');
        } else if (/#/.test(_data)) {
            arr.push(',"' + _data + '".red');
        } else {
            arr.push(',"' + _data + '"');
        }
    });
    read.on('end', function() {
        fs.writeFileSync('output.txt', arr.join('\n'));
        print(fs.readFileSync('output.txt', 'utf8'));
    });
});
