#!/usr/bin/env node

var rest = require('restler'),
    fs = require('fs'),
    byline = require('byline'),
    args = require('optimist').argv;

rest.get(args.url).on('complete', function(data) {
    fs.writeFileSync('input.txt', data);

    var read = byline(fs.createReadStream('input.txt'));
    var write = fs.createWriteStream('output.txt');
    var arr = [];
    read.on('data', function (data) {
        //console.log('--->', data);
        _data = "\\t" + data.replace(/'/g, "\\'");
        if (/###/.test(_data)) {
            arr.push(",'" + _data + "'.magenta");
        } else if (/##/.test(_data)) {
            arr.push(",'" + _data + "'.cyan");
        } else if (/#/.test(_data)) {
            arr.push(",'" + _data + "'.red");
        } else {
            arr.push(",'" + _data + "'");
        }
    });
    read.on('end', function() {
        fs.writeFileSync('output.txt', arr.join('\n'));
        console.log(fs.readFileSync('output.txt', 'utf8'));
    });
});
